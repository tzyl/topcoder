from collections import deque


class FromToDivisibleDiv2(object):
    # O(M^2)
    def shortest(self, N, S, T, a, b):
        # BFS on b[0],...,b[M-1].
        M = len(a)
        d = [None] * M
        Q = deque()
        for i in xrange(M):
            if S % a[i] == 0:
                d[i] = 1
                Q.append(i)
        while Q:
            i = Q.popleft()
            if T % b[i] == 0:
                return d[i]
            for j in xrange(M):
                if d[j] is None and lcm(a[j], b[i]) <= N:
                    d[j] = d[i] + 1
                    Q.append(j)
        return -1

    # Not fast enough O(N*M).
    def shortest2(self, N, S, T, a, b):
        # BFS from source S to find T.
        d = [None] * (N + 1)
        Q = deque([S])
        visited = set([S])
        d[S] = 0
        while Q:
            i = Q.popleft()
            # Calculate neighbours on the fly to save memory and time.
            for j in calculate_neighbours(N, i, a, b):
                if j not in visited:
                    d[j] = d[i] + 1
                    visited.add(j)
                    Q.append(j)
                    if j == T:
                        return d[j]
        return -1


def calculate_neighbours(N, i, a, b):
    M = len(a)
    for k in xrange(M):
        if i % a[k] == 0:
            for j in xrange(b[k], N + 1, b[k]):
                yield j


def gcd(a, b):
    while b:
        a, b = b, a % b
    return a


def lcm(a, b):
    return a * b / gcd(a, b)

if __name__ == '__main__':
    print FromToDivisibleDiv2().shortest(11, 9, 6, [3, 10], [5, 2])
    print FromToDivisibleDiv2().shortest(12345, 18, 12, [1, 42, 50], [1, 17, 3])
    print FromToDivisibleDiv2().shortest(100000, 16846, 50106, [89808, 317, 99686, 95691, 38686, 77746, 95829, 69358, 81688, 64021, 73049, 75, 756, 50463, 853, 55385, 88913, 84753, 81071, 656, 787, 79433, 81258, 82773, 45450, 147, 45667, 54068, 48626, 41173, 67175, 760, 98526, 256, 38192, 413, 655, 70041, 44037, 78289, 181, 440, 39005, 41145, 74, 35721, 70506, 94849, 91903, 689, 50831, 572, 94216, 41594, 736, 69667, 70013, 74996, 632, 60868, 51275, 520, 735, 117, 91546, 67656, 902, 880, 815, 916, 426, 72323, 34956, 91079, 71887, 256, 846, 43137, 85661, 91206, 70022, 53225, 97252, 39524, 69290, 266, 66258, 678, 38592, 91655, 59881, 392, 96189, 90926, 38592, 53159, 98768, 84457, 70246, 68440, 38634, 522, 521, 319, 89808, 773, 89065, 418, 55690, 48212, 65417, 43894, 47540, 41102, 350, 62795, 95586, 89065, 78289, 54805, 81074, 66927, 91079, 569, 64583, 102, 50831, 55703, 471, 757, 720, 58108, 64269, 69667, 58849, 163, 38644, 76612, 57966, 76349, 55690, 86924, 98052, 148, 132, 50485, 76102, 75506, 57455, 81074, 99686, 56401, 505, 64583, 62367, 82962, 932, 73910, 62933, 38341, 67250, 74748, 324, 464, 252, 43427, 54729, 38192, 45413, 43137, 53081, 70041, 84152, 535, 751, 45341, 73161, 55931, 98, 70022, 41102, 77438, 86062, 87068, 94949, 73247, 35499, 365, 762, 858, 88663, 94726, 81985, 99, 81985, 35499, 75279, 90549, 45121, 34, 72664, 903, 42774, 60365, 857, 35891, 82681, 34921, 272, 72899, 98052, 50258, 20, 94216, 73568, 81547, 44993, 72664, 58018, 45413, 522, 96189, 67250, 56, 734, 994, 77980, 59008, 41090, 80, 73247, 99678, 95162, 41102, 90926, 84628, 895, 36214, 50907, 860, 33, 50907, 64536, 45450, 866, 42735, 79433, 38024, 77746, 75559, 53051, 50485, 60355, 58454, 90892, 96077, 57981, 290, 73199, 37673, 73161, 84324, 85701, 74996, 38889, 46489, 34516, 36214, 78812, 99169, 57087, 61171, 81162, 46090, 96077, 184, 97442, 44037, 823, 71937, 92104, 63961, 37669, 34516, 67522, 86489, 106, 38634, 33967, 99931, 53081, 33967, 934, 54068, 82387, 82962, 96805, 82773, 97221, 57933, 68315, 43816, 64964, 94849, 66072, 873, 98768, 562, 37212, 763, 8423, 95829, 262, 203, 746, 67894, 75506, 288, 666, 552, 627, 75506, 917, 95162, 51230, 88663, 34921, 899, 934, 86062, 181, 62908, 64975, 51462, 3, 49057, 56251, 42492, 91903, 582, 93661, 364, 84970, 65609, 584, 727, 38686, 52801, 697, 70041, 685, 75279, 691, 40664, 45218, 77971, 190, 81162, 919], [84324, 304, 34516, 45341, 51462, 50485, 95162, 70013, 67656, 53225, 37212, 122, 408, 74748, 490, 55931, 94726, 94216, 78812, 315, 165, 34956, 95691, 95691, 55931, 744, 44037, 96189, 45450, 35891, 41090, 653, 67894, 20, 38024, 425, 568, 86924, 71937, 88663, 557, 876, 55703, 91903, 789, 86489, 85701, 62795, 48626, 903, 45413, 156, 35721, 56251, 359, 74996, 72323, 73568, 613, 35721, 38634, 98, 350, 503, 85661, 58849, 433, 539, 101, 409, 148, 77746, 58018, 69290, 66072, 41, 839, 61171, 76612, 53051, 79433, 91655, 64964, 45121, 97252, 193, 60868, 580, 73910, 73247, 64021, 461, 46489, 91903, 82387, 81071, 43427, 67250, 91079, 84457, 58849, 315, 877, 737, 43137, 428, 34956, 509, 94849, 84628, 40664, 70041, 97221, 58108, 186, 81547, 86924, 70022, 86062, 45413, 85701, 33967, 96077, 513, 71937, 729, 54805, 98052, 758, 16, 679, 53159, 45218, 73568, 50831, 378, 45667, 41594, 91546, 47540, 62795, 35499, 96189, 702, 84, 67175, 64269, 98768, 77438, 70506, 42774, 59881, 712, 77980, 46489, 75279, 58, 99678, 46090, 38686, 76102, 57933, 971, 368, 649, 66927, 53081, 50485, 73910, 70013, 69667, 35499, 76349, 489, 392, 62933, 58454, 82773, 812, 34956, 81071, 72899, 99169, 42492, 90926, 57087, 67522, 418, 890, 369, 41173, 72664, 60365, 507, 91206, 37673, 43894, 81985, 37669, 833, 56401, 352, 97442, 89808, 356, 42735, 88913, 81074, 463, 39524, 84970, 43427, 98, 66258, 82962, 38889, 73568, 59881, 65417, 38592, 610, 62367, 45218, 391, 647, 776, 55690, 34921, 50463, 714, 57966, 41102, 38644, 53159, 64975, 64536, 217, 44993, 67894, 582, 616, 98526, 51275, 55385, 973, 65609, 58018, 67175, 38192, 51230, 60365, 62908, 43816, 68315, 84152, 69290, 99686, 145, 73161, 67522, 68315, 43137, 93661, 44993, 38341, 73049, 42774, 69667, 52801, 88663, 57966, 69358, 90549, 81162, 64964, 343, 39005, 64583, 699, 77980, 78289, 81258, 25053, 97442, 95829, 99931, 68, 81688, 73199, 50907, 36214, 73161, 279, 46489, 73910, 43894, 84753, 63961, 70246, 87068, 68440, 75506, 77971, 81547, 54729, 381, 50258, 488, 96805, 234, 92104, 38644, 887, 846, 188, 90892, 43427, 454, 613, 512, 285, 50258, 933, 45667, 59008, 42735, 85701, 489, 241, 88663, 884, 38024, 41145, 75559, 74, 89065, 71887, 57981, 45450, 270, 48212, 907, 54068, 60355, 810, 251, 75559, 94949, 89, 95586, 290, 70041, 321, 82681, 49057, 57455, 229, 81985, 186])
